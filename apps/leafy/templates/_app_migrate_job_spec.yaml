{{- define "app.migrate.job.spec" }}
backoffLimit: 1
template:
  spec:
    containers:
    - name: migrate
      image: {{ .Values.appImage }}
      args: ["migrate"]
      env:
        - name: DJANGO_SECRET_KEY
          valueFrom: {"secretKeyRef": {"name": "app", "key": "DJANGO_SECRET_KEY"}}
        - name: DEBUG
          value: "False"
        - name: DJANGO_DATABASE_ENGINE
          value: "postgres"
        - name: DJANGO_DATABASE_NAME
          value: "postgres"
        - name: DJANGO_DATABASE_USER
          value: "postgres"
        - name: DJANGO_DATABASE_PASSWORD
          valueFrom: {"secretKeyRef": {"name": "app", "key": "DJANGO_DATABASE_PASSWORD"}}
        - name: DJANGO_DATABASE_HOST
          value: "db"
        - name: DJANGO_DATABASE_PORT
          value: "5432"
    restartPolicy: Never
{{- end }}